const url = "http://ip-api.com/json/?fields=8450015&lang=VN";

$httpClient.get(url, function(error, response, data) {
    if (error) {
        console.error('Có lỗi xảy ra:', error);
        return;
    }

    try {
        const jsonData = JSON.parse(data);
        const { query, isp, as, country, city, timezone, lon, lat, currency, countryCode } = jsonData;
        const emoji = getFlagEmoji(countryCode);
        const body = {
            title: "Thông tin",
            content: `IP：${query}\nNhà cung cấp：${isp}\nASN：${as}\n🌍Quốc gia/Khu vực：${emoji}${country}\nThành phố：${city}\nMúi giờ：${timezone}\nVĩ độ và Kinh độ：${lon},${lat}\nTiền tệ：${currency}`,
            icon: "🌐",
            "icon-color": "blue"
        };
        $done(body);
    } catch (e) {
        console.error('Lỗi khi phân tích dữ liệu JSON:', e);
    }
});

function getFlagEmoji(countryCode) {
    const codePoints = countryCode
        .toUpperCase()
        .split('')
        .map(char => 127397 + char.charCodeAt());
    return String.fromCodePoint(...codePoints);
}
